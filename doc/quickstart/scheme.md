# 方糖推荐服务私有云方案

## 一、方案背景
- 方糖推荐服务·私有云方案，是汗粮科技针对海外或非公网的特殊性环境，推出的自动化影视点播编排运营方案。

- 基于环境的特殊性，服务商做海外或非公网的影视点播时都需要本地化部署，也需要本地化人工运营，导致成本难以降低，转化效率难以提升。汗粮科技针对这些情况，推出了方糖推荐服务·私有云方案，可以有效降低运营成本提高运营效率。

- 汗粮科技的研发团队有多年专注于免人工AI运营影视点播的经验，也打造出了零人工运营的产品——超百万用户的方糖免费视频APP，用成功的产品证明了自己的实力。

## 二、系统架构图

![系统架构图](https://github.com/hfgang/fangtang/blob/master/doc/quickstart/方糖私有云架构图.png)

## 三、各模块说明

### 1、汗粮云端模块
- 数据处理服务

数据处理服务，可以对没有标签的原始媒资数据经过清洗、格式转化、自动提取或通过豆瓣、IMDB、TMDB等第三方平台进行关联的方式来补充推荐所需要的标签数据，最终生产符合推荐系统所需要的数据结构。

- 私有云平台管理系统

私有云平台管理系统，用于管理各私有云平台，监测私有云平台运行状态，更新推荐知识于推荐算法。

### 2、私有云模块
- 数据处理与索引模块

提供媒资数据的同步接口，处理指定格式的带有标签的媒资数据，根据推荐算法，生成推荐索引库，以便推荐中台提供服务使用。

- 推荐中台服务模块

提供推荐查询接口，通过提交用户最近的不超过50条的历史观看行为，获取针对该用户的后续推荐播放资源列表。

- 媒资数据存储模块

媒资数据存储模块负责存储同步的媒资数据以及经过推荐算法生成的推荐知识库与关键数据缓存库。

## 四、业务流程
### 1、媒资数据同步

将需要推荐的媒资数据按照格式要求，通过同步接口提交到在客户本地部署的私有云服务中。如果媒资数据无法生成指定的格式或缺少必选的标签字段，则可以将媒资数据批量提交到汗粮云端服务模块，经过汗粮云端模块处理后，再异步写回本地私有云系统中。

### 2、推荐数据处理

由私有云服务系统自动完成对同步的媒资数据的处理，生成推荐查询引擎，并提供推荐查询服务。

### 3、查询推荐结果

- 1）用户在终端（电视、手机、机顶盒等）需要获取推荐数据时，向客户服务端中台提交设备ID或客户ID。
- 2）服务端中台通过设备ID或客户ID，调取该用户的最近30条的观影历史数据（时间、时长、资源名称、资源类型等）。
- 3）将观影历史数据按推荐查询接口的参数要求，提交到推荐推荐中台服务的推荐查询接口，并获得推荐结果列表（带有排序的媒资ID，若观影历史为空，则下发根据算法生成的热门推荐数据）。
- 4）服务端中台对推荐结果列表，按照当前用户终端要求的播放格式重新组装下发数据（播放地址、封面图等）并向终端下发（根据实际环境，服务端终端可加入不同级别的缓存机制）。
- 5）终端接收到下发数据后，按要求进行显示。

## 五、实施步骤

- 第一步：媒资数据同步（详述）
- 第二步：推荐服务私有云部署（详述）
- 第三步：推荐数据查询接口对接（详述，云对云/客户端对云）
- 第四步：前端UI修改

## 六、API接口说明

### 1、媒资同步接口
- 详细说明或接口链接地址

### 2、推荐数据查询接口
- 详细说明或接口链接地址

## 七、FAQ
